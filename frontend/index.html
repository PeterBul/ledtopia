<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <title>Websockets</title>
    <link
      href="https://unpkg.com/core-elements/dist/themes/minimal.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/core-elements"></script>
  </head>

  <body>
    <div id="app">
      <core-flex
        style="height: 100vh"
        align-items="center"
        justify-content="center"
      >
        <core-toggle size="lg" :checked="on" @change="toggleLED">
          Turn {{ on ? "off" : "on" }} the LED
        </core-toggle>
        <core-toggle size="lg" :checked="fade" @change="toggleFade">
          Turn fade {{ fade ? "off" : "on" }}
        </core-toggle>
        <core-toggle size="lg" :checked="blink" @change="toggleBlink">
          {{ blink ? "Stop" : "Start" }} blinking
        </core-toggle>
      </core-flex>
    </div>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script type="module">
    const app = new Vue({
      created() {
        this.socket = new WebSocket("ws://" + "192.168.0.19" + ":81/");
      },
      data: {
        socket: null,
        on: false,
        blink: false,
        fade: false,
        interval: null,
        name: "Leif",
      },
      watch: {
        blink: function (val) {
          if (val) {
            this.interval = setInterval(this.toggleLED, 200);
          } else {
            clearInterval(this.interval);
          }
        },
        on: function (val) {
          this.socket.send(val ? "1" : "0");
        },
        fade: function (val) {
          this.socket.send(val ? "F" : "N");
        },
      },
      methods: {
        toggleLED(e) {
          this.on = e.target.checked;
        },
        toggleBlink(e) {
          this.blink = e.target.checked;
        },
        toggleFade(e) {
          this.fade = e.target.checked;
        },
      },
    }).$mount("#app");
  </script>
</html>
